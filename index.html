<!doctype html>

<html>
	<!-- This is what a comment looks like -->
	<head>
		<title>Air Quality Map</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
		<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
		<script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>
		<script src="https://cdn.jsdelivr.net/npm/vue"></script>
		<link rel="stylesheet" href="style.css">

	</head>
	<body>
		<div id="whole_thing">
			<header>Air Quality Map</header>
			<nav>
				<ul>
					<li><a href="index.html" class="current">Air Quality Map</a></li>
					<li><a href="aboutme.html">About Me</a></li>
				</ul>
			</nav>
			<ais-search-box placeholder="Find products..."></ais-search-box>
			<div id="searchBox">
				<!-- TODO: searchbox using locationiq, will then send the latitude/longitude into map.setView -->
				<div id="vuesearch">
				URL: <input type="text" v-model.trim="location" v-on:keyup.enter="xhr">
	  			<button v-on:click="xhr">Search</button><br>
	  			<pre v-if="info.length > 0 && info[0].hasOwnProperty('lat') && info[0].hasOwnProperty('lon')">{{ info[0].lat }} , {{ info[0].lon }}</pre>
	  			</div> <!-- vuesearch div -->
	  			<script type="text/javascript">
	  				var vueApp = new Vue({
				    	el: '#vuesearch',
				    	data: {
				    		location: "Empire State Building",
				    		info: []
				 	 	},
				 	 	computed: {
				 	 		url: function(){
				 	 			return "https://us1.locationiq.com/v1/search.php?key=174d247abdd29b&q=" + encodeURI(this.location) + "&format=json"
				 	 		}
				 	 	},
				 	 	methods: {
						    xhr: function() {
						      vueApp.info = "Requesting ...";
						      var rq = new XMLHttpRequest();

						      rq.onreadystatechange = function() {
						        if (rq.readyState === XMLHttpRequest.DONE) {
						          if (rq.status === 200) {
						            vueApp.info = JSON.parse(rq.responseText);
						          } else {
						            vueApp.info = "Request Failed";
						          }
						        }
						      };
						      console.log(vueApp.url);
						      rq.open("GET", vueApp.url);
						      rq.send();
						    }
				  }
				})	  				
	  			</script>
				<script type="text/javascript">
					var settings = {
				    "async": true,
				    "crossDomain": true,
				    "url": "https://us1.locationiq.com/v1/search.php?key=174d247abdd29b&q=Empire%20State%20Building&format=json",
				    "method": "GET"
				    }	    
				</script>
			</div>
			<div id="map"></div>
		</div>
		<script src="leaflet-heat.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script src="aq.js"></script>
	</body>
</html>