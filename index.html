<!doctype html>

<html>
	<!-- This is what a comment looks like -->
	<head>
		<title>Air Quality Map</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
		<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
		<script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>
		<script src="https://cdn.jsdelivr.net/npm/vue"></script>
		<link rel="stylesheet" href="style.css">

	</head>
	<body>
		<header>Air Quality Map</header>
		<nav>
			<ul>
				<li><a href="index.html" class="current">Air Quality Map</a></li>
				<li><a href="aboutme.html">About Me</a></li>
			</ul>
		</nav>
		<ais-search-box placeholder="Find products..."></ais-search-box>
		<div id="searchBox">
			<!-- TODO: searchbox using locationiq, will then send the latitude/longitude into map.setView -->
			<div id="vuesearch">
			URL: <input type="text" v-model.trim="url" v-on:keyup.enter="xhr">
  			<button v-on:click="xhr">Search</button><br>
  			<pre>{{ info }}</pre>
  			</div>

  			<script type="text/javascript">
  				new Vue({
			    el: '#vuesearch',
			    data: {
			    url: "https://us1.locationiq.com/v1/search.php?key=174d247abdd29b&q=Empire%20State%20Building&format=json",
			    info: ""
			  },
			  methods: {
			    xhr: function() {
			      this.info = "Requesting ...";
			      var rq = new XMLHttpRequest();

			      rq.onreadystatechange = function(vm) {
			        if (this.readyState === XMLHttpRequest.DONE) {
			          if (this.status === 200) {
			            vm.info = this.responseText;
			          } else {
			            vm.info = "Request Failed";
			          }
			        }
			      }.bind(rq, this);

			      rq.open("GET", this.url);
			      rq.send();
			    }
			  }
			})
  			</script>

			<script type="text/javascript">
				var settings = {
			    "async": true,
			    "crossDomain": true,
			    "url": "https://us1.locationiq.com/v1/search.php?key=174d247abdd29b&q=Empire%20State%20Building&format=json",
			    "method": "GET"
			    }
			    
			</script>
		</div>
		<div id="map"></div>
		<script src="leaflet-heat.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script type="text/javascript">

		var map = L.map('map').setView([44.9537, -93.0900], 10);

		var tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(map);

		var greenIcon = L.icon({
		    iconUrl: 'leaf-green.png', //We can rock any image
		    shadowUrl: 'leaf-shadow.png', //Some sort of shadow

		    iconSize:     [38, 95], // size of the icon
		    shadowSize:   [50, 64], // size of the shadow
		    iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
		    shadowAnchor: [4, 62],  // the same for the shadow
		    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
		});

		var particleSpot = [44.9537, -93.0900];

		var marker = L.marker([44.9537, -93.0900],{icon: greenIcon}).addTo(map).bindPopup("This is a air quality measurement.");

		var heat = L.heatLayer([
		[particleSpot[0], particleSpot[1], 200.0] // lat, lng, intensity (each member of this list is another point to add the heat to. Just import the station data as a list)
		], {radius: 30}).addTo(map);

		//var map = L.map('map')
		//	.addLayer(mapboxTiles)
		//	.setView([44.9537, -93.0900], 12);

		var searchLayer = L.layerGroup().addTo(map);
		//... adding data in searchLayer ...
		//map.addControl( new L.Control.Search({layer: searchLayer}) );
		//searchLayer is a L.LayerGroup contains searched markers

		//Get the data to populate the map we will need to wait until there is a pause in the movements
		const url = "https://api.openaq.org/v1/locations?coordinates=44.9537,-93.0900&radius=25000";
		const vm = new Vue({
        el: '#app',
        data: {
          results: []
        },
        mounted() {
          axios.get(url).then(response => {
            this.results = response.data

            //All the data

            //One city long and lat example - Just loop -
            console.log(response.data.results[0].coordinates.longitude);
            console.log(response.data.results[0].coordinates.latitude);
            console.log(response);
            for(var i = 0; i < response.data.results.length; i++)
            {
            	console.log(i);
            	if (response.data.results[i].hasOwnProperty('coordinates')){
            		var marker = L.marker([response.data.results[i].coordinates.latitude, response.data.results[i].coordinates.longitude],{icon: greenIcon}).addTo(map).bindPopup("This is a air quality measurement.");
            	}
            }
            console.log(response);

          })
        }
      });
		</script>
	</body>
</html>